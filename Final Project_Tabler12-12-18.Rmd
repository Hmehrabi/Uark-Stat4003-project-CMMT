---
title: "STAT 4003 Final Project"
output: pdf_document
author: "Coles,Mai,Mehrabi,Tabler"
Date: "Dec 12th 2018"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(here)
library(scales)
library(knitr)
```
link to comic Characters: \href{https://github.com/rfordatascience/tidytuesday/blob/master/data/2018-05-29/week9_comic_characters.csv}{here} 

link to parking date: \href{https://www.kaggle.com/cityofLA/los-angeles-parking-citations#parking-citations.csv}{here}


```{r}
datcomic<-read.csv(here('Final Project','tidytuesday-comic.csv'))
#datpark<-read.csv(here('project','parking-citations.csv'))
```

There are a tone of data points in the parking data so I subsampled 100000 data points  using subsample code. We can use the smaller data set to test out  the code and develop statistical hypothesys.

```{r}
#n=100000
#smalldat<- datpark[sample(1:nrow(datpark), n, replace=FALSE),]
#write.csv(smalldat,file=here('Final Project','parking-sub-dat.csv'))
smalldat<-read.csv(here('Final Project','parking-sub-dat.csv'))
```

```{r,echo=FALSE}
ggplot(data=smalldat,aes(smalldat$Issue.time))+
geom_histogram(bins=24)+
xlab('time(hhmm)')

#lm(smalldat$Color~dat2$Make)
#dat$Issue.time
```


```{r,echo=FALSE}

#na.omit deletes any field that hase 'NA' as value. in this case the value "date" only
#keeps the fields in Issue.Date of the subsample that have a value and are not 'NA'.
date<-na.omit(smalldat$Issue.Date)
#gsub substitues the characters in this case the time ('T00:00:00') with nothing ('').
#we are using this code to delete those parts form the text.
date<-gsub('T00:00:00','',date)
# this code turns the strings that are formated year-month-day in the list into dates.
date<-as.Date(date,format="%Y-%m-%d")


ggplot(data=NULL,aes(x=date))+
geom_histogram(bins=52*3)+
scale_x_date(labels=date_format("%B-%Y"),breaks = "2 months",limits=c(as.Date("2015-01-1"),as.Date("2018-01-01")))+
# to see more date formats check the link below
# https://www.statmethods.net/input/dates.html
# to change the range change the date values for examle to have all of 2017 you can use:
#scale_x_date(labels=date_format("%b"),breaks = "1 month",limits=c(as.Date("2017-01-1"),as.Date("2018-01-01")))
xlab('date(months)')+
ggtitle('number of tickets given from Jan-2015 to Dec-2017')+
theme(axis.text.x=element_text(angle=90,hjust=1))
```



\href{https://www.timeanddate.com/calendar/weekday-monday-1}{months begining with moday}


```{r,echo=FALSE}

date<-sort(date)
begin<-c('2015-06-01','2016-02-01','2016-08-01','2017-05-01','2018-01-01')
end<-c('2015-06-30','2016-02-28','2016-08-30','2017-05-30','2018-01-30')
firstmonday<-NULL
for (i in seq(5) ){
    firstmonday<-append(firstmonday,date[date >= as.Date(begin[i]) & date <= as.Date(end[i])])
}
firstmonday_Day<-as.integer(format(firstmonday,"%d"))
ggplot(data=NULL,aes(x=firstmonday_Day))+
geom_histogram(bins=30)+
xlab('day of month')+
ggtitle('number of tickets given on the day of the month starting from Monday ')
```



```{r,echo=FALSE}
smalldat<-read.csv(here('Final Project','parking-sub-dat.csv'))
SaleCarCol<-read.csv(here('Final Project','CarColormod.csv'))
SaleCarCol$type<-"Sales"
smalldat$Color[smalldat$Color!="BK"&smalldat$Color!="BL"&smalldat$Color!="GY"&smalldat$Color!="RD"&smalldat$Color!="SL"&smalldat$Color!="WT"] <-"OT"

Color<-c("BK","BL","GY","RD","SL","WT","OT")
ratio<-rep(0,7)
number<-rep(0,7)
for(col in seq(1,7)){
ratio[col]<-(nrow(smalldat[smalldat$Color==Color[col],])/nrow(smalldat))
number[col]<-nrow(smalldat[smalldat$Color==Color[col],])
}
TicketCarCol<-data.frame(Color,ratio,number)
TicketCarCol$type<-"ticket"
chisq.test(TicketCarCol$number,p=SaleCarCol$ratio)

#SaleCarCol

ratio_tot<-rbind(TicketCarCol[,-3],SaleCarCol)
ggplot(data = ratio_tot, aes(x=Color,y=ratio,fill=type)) +
geom_bar(stat = "identity",position = 'dodge')+
ggtitle('Ratio of Cars reciveing a ticket as a function of Color comapred to sales ')

  #theme(axis.text.x=element_text(angle=90,hjust=1))
  #summary(smalldat$Color)
```






```{r,echo=FALSE}

datcomic<-read.csv(here('Final Project','tidytuesday-comic.csv'))
datcomic<-datcomic[datcomic$sex!= 'Genderless Characters'& datcomic$sex!= 'Agender Characters'& datcomic$sex!= 'Transgender Characters' &datcomic$sex!='Genderfluid Characters',]

DC_comic<-datcomic[datcomic$publisher=='DC',]
Marvel_comic<-datcomic[datcomic$publisher=='Marvel',]

ggplot(data=DC_comic ,aes(x=DC_comic$year,color=DC_comic$sex))+
geom_histogram(bins=76)+
xlab('Year')+
ylab('Count')+
ggtitle('number of characters introduced to the DC universe devided by gender')

ggplot(data=Marvel_comic ,aes(x=Marvel_comic$year,color=Marvel_comic$sex))+
geom_histogram(bins=74)+
xlab('Year')+
ylab('Count')+
ggtitle('number of characters introduced to the Marvel universe devided by gender')

```
    
```{r,echo=FALSE}

#This the type of coding I hate, I would have rather done this using dataframes but we were in a hurry. Sorry :(

datcomic<-read.csv(here('Final Project','tidytuesday-comic.csv'))
datcomic$gsm <-NULL
DC_comic<-datcomic[datcomic$publisher=='DC',]
Marvel_comic<-datcomic[datcomic$publisher=='Marvel',]

DC_Fem_comic<-DC_comic[DC_comic$sex == 'Female Characters',]
DC_Male_comic<-DC_comic[DC_comic$sex == 'Male Characters',]

Marvel_Fem_comic<-Marvel_comic[Marvel_comic$sex == 'Female Characters',]
Marvel_Male_comic<-Marvel_comic[Marvel_comic$sex == 'Male Characters',]
DC_FM_ratio<-rep(0,90)
DC_app_ratio<-rep(0,90)
Marvel_FM_ratio<-rep(0,90)
Marvel_app_ratio<-rep(0,90)
FM_ratio<-data.frame(matrix(ncol = 2, nrow = 150))
for (I in seq(1936,2010,by=1)) {

    Fem_year<-nrow(DC_Fem_comic[DC_Fem_comic$year==I,])
    Fem_app<-sum(na.omit(DC_Fem_comic[DC_Fem_comic$year==I,'appearances']))
    
    Male_year<-nrow(DC_Male_comic[DC_Male_comic$year==I,])
    Male_app<-sum(na.omit(DC_Male_comic[DC_Male_comic$year==I,'appearances']))
    DC_app_ratio[I]<-(Fem_app/(Male_app+Fem_app))
    DC_FM_ratio[I]<-(Fem_year/(Male_year+Fem_year))

}
for (I in seq(1936,2010,by=1)){
    Fem_year<-nrow(Marvel_Fem_comic[Marvel_Fem_comic$year==I,])
    Fem_app<-sum(na.omit(Marvel_Fem_comic[Marvel_Fem_comic$year==I,'appearances']))
    Male_year<-nrow(Marvel_Male_comic[Marvel_Male_comic$year==I,])
    Male_app<-sum(na.omit(Marvel_Male_comic[Marvel_Male_comic$year==I,'appearances']))
    Marvel_FM_ratio[I]<-Fem_year/(Male_year+Fem_year)
    Marvel_app_ratio[I]<-(Fem_app/(Male_app+Fem_app))


}
Marvel_FM_ratio_df<-data.frame(ratio=Marvel_FM_ratio[1936:2010])
Marvel_FM_ratio_df$app_ratio<-Marvel_app_ratio[1936:2010]
Marvel_FM_ratio_df$year<-seq(1936,2010,by=1)
Marvel_FM_ratio_df$publisher<-'Marvel'

DC_FM_ratio_df<-data.frame(ratio=DC_FM_ratio[1936:2010])
DC_FM_ratio_df$app_ratio<-DC_app_ratio[1936:2010]
DC_FM_ratio_df$year<-seq(1936,2010,by=1)
DC_FM_ratio_df$publisher<-'DC'

FM_ratio<-rbind(DC_FM_ratio_df,Marvel_FM_ratio_df)

ggplot(data=FM_ratio,aes(x=FM_ratio$year,y=FM_ratio$ratio,color=FM_ratio$publisher))+
stat_smooth(method="lm")+
xlab('year')+
ylab('First appearance ratio')+
geom_point()


ggplot(data=FM_ratio,aes(x=FM_ratio$year,y=FM_ratio$app_ratio,color=FM_ratio$publisher))+
stat_smooth(method="lm")+
xlab('year')+
ylab('total appearance ratio')+
geom_point()

```

    Marvel develops female charachters less. This can be supported by the fact that Marvel and DC both appear the same amount of female characters proportionaltely; however, Marvel creates and introduces more female characters than DC, proportionately. 


```{r,echo=FALSE}

##linear model  of  the female total appearances over the years in The DC universe 
DC_app_fit<-lm(DC_FM_ratio_df$app_ratio~DC_FM_ratio_df$year)
summary(DC_app_fit)

##linear model  of  the female total appearances over the years in The Marvel universe 
Marvel_app_fit<-lm(Marvel_FM_ratio_df$app_ratio~Marvel_FM_ratio_df$year)
summary(Marvel_app_fit)
```



```{r,echo=FALSE}
##linear model  of  the female  appearance ratio by year in The DC universe 
Marvel_ratio_fit<-lm(Marvel_FM_ratio_df$ratio~Marvel_FM_ratio_df$year)
summary(Marvel_ratio_fit)
##linear model  of  the female  appearance ratio by year in The Marvel universe 
DC_ratio_fit<-lm(DC_FM_ratio_df$ratio~DC_FM_ratio_df$year)
summary(DC_ratio_fit)
```



```{r,echo=FALSE}
#datcomic<-read.csv(here('Final Project','tidytuesday-comic.csv'))
datcomic$hair[datcomic$hair=='No Hair']<-"Bald"
#summary(datcomic$hair)
#print(str(datcomic))

chisq.test(datcomic$eye, datcomic$align)
table(datcomic$eye, datcomic$align)

chisq.test(datcomic$hair, datcomic$align)
table(datcomic$hair, datcomic$align)

hairlist=c('Bald','Black')


Chi_hair<-datcomic[datcomic$hair=='Black Hair'|datcomic$hair=='Blond Hair'|datcomic$hair=='Bald'|datcomic$hair=='Brown Hair'|datcomic$hair=='Grey Hair'|datcomic$hair=='No Hair'|datcomic$hair=='Red Hair'|datcomic$hair=='White Hair',]


chisq.test(Chi_hair$hair, Chi_hair$align)
#table(Chi_hair$hair, Chi_hair$align)

Chi_eyes<-datcomic[datcomic$eye=='Black Eyes'|datcomic$eye=='Blue Eyes'|datcomic$eye=='Brown Eyes'|datcomic$eye=='Green Eyes'|datcomic$eye=='Grey Eyes',]

chisq.test(Chi_eyes$eye, Chi_eyes$align)
#table(Chi_eyes$hair, Chi_hair$align)
```





```{r}
##Junk we can put in the appendix
##
ggplot(data=Marvel_comic ,aes(x=Marvel_comic$appearances,color=Marvel_comic$sex))+
geom_histogram(bins=74)
ggplot(data=DC_comic ,aes(x=DC_comic$appearances,color=DC_comic$sex))+
geom_histogram(bins=76)
```